<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title> - Lijin Zhang</title>
    <meta property="og:title" content=" - Lijin Zhang">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="[TOC]
[&amp;hellip;] 18名棒球运动员在1970年赛季的前45次击球的平均击中率(y变量)
[&amp;hellip;] TITLE:	Model 4: Explaining variation in the level-2 intercept and slope; DATA: FILE IS: C:\ Mplus1\ch3new.dat; 	Format is 5f8.0, 3f8.2; &amp;hellip;">
      <meta property="og:description" content="[TOC]
[&amp;hellip;] 18名棒球运动员在1970年赛季的前45次击球的平均击中率(y变量)
[&amp;hellip;] TITLE:	Model 4: Explaining variation in the level-2 intercept and slope; DATA: FILE IS: C:\ Mplus1\ch3new.dat; 	Format is 5f8.0, 3f8.2; &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  
  <body class="share">
    <header class="masthead">
      <h1><a href="/">Lijin Zhang</a></h1>



      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">Home</a></li>
  
  <li><a href="/publications">Publications</a></li>
  
  <li><a href="/experiences">Experiences</a></li>
  
  <li><a href="/post/">中文</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1></h1>

<h3>
</h3>
<hr>


      </header>


<main class="content" role="main">

  <article class="article">


    

    
    

    <div class="article-content">
      <h1 id="实例2数据代码和结果">实例2：数据、代码和结果</h1>
<p>[TOC]</p>
<h2 id="单变量模型在mplus中的实现">单变量模型在mplus中的实现</h2>
<p>18名棒球运动员在1970年赛季的前45次击球的平均击中率(y变量)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>TITLE<span style="color:#666">:</span>	 Model <span style="color:#40a070">4</span><span style="color:#666">:</span> Explaining variation in the level<span style="color:#40a070">-2</span> intercept and slope;
</span></span><span style="display:flex;"><span>DATA<span style="color:#666">:</span>  FILE IS<span style="color:#666">:</span> C<span style="color:#666">:</span>\ Mplus1\ch3new.dat;
</span></span><span style="display:flex;"><span>	     Format is <span style="color:#40a070">5</span>f8.0, <span style="color:#40a070">3</span>f8.2;
</span></span><span style="display:flex;"><span>VARIABLE<span style="color:#666">:</span>	
</span></span><span style="display:flex;"><span>        Names are deptid morale satpay female white pctbelow lev1wt lev2wt;
</span></span><span style="display:flex;"><span>        Usevariables are  morale;
</span></span><span style="display:flex;"><span>        Cluster is deptid;  <span style="color:#666">!</span>分组变量为deptid
</span></span><span style="display:flex;"><span>        Between <span style="color:#666">=</span> ; <span style="color:#666">!</span>定义组间变量
</span></span><span style="display:flex;"><span>        Within <span style="color:#666">=</span>; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ANALYSIS<span style="color:#666">:</span>	
</span></span><span style="display:flex;"><span>        Type<span style="color:#666">=</span> Twolevel;   <span style="color:#666">!</span>Twolevel定义两层模型，<span style="color:#06287e">random定义随机斜率</span>(β<span style="color:#40a070">1</span>)模型
</span></span><span style="display:flex;"><span>        Estimator <span style="color:#666">=</span> Bayes;  <span style="color:#666">!</span>定义估计方法
</span></span><span style="display:flex;"><span>        Biterations <span style="color:#666">=</span> (<span style="color:#40a070">20000</span>);  <span style="color:#666">!</span>定义模型最小迭代次数为<span style="color:#40a070">20000</span>次
</span></span><span style="display:flex;"><span>        Point <span style="color:#666">=</span> Median;  <span style="color:#666">!</span> 定义点估计报告后验分布的中位数结果
</span></span><span style="display:flex;"><span>Model<span style="color:#666">:</span>	<span style="color:#666">%Between%</span>
</span></span><span style="display:flex;"><span>    	morale 
</span></span><span style="display:flex;"><span>    	<span style="color:#666">%Within%</span>
</span></span><span style="display:flex;"><span>    	morale 
</span></span><span style="display:flex;"><span>OUTPUT<span style="color:#666">:</span>	TECH1;
</span></span><span style="display:flex;"><span>PLOT<span style="color:#666">:</span> TYPE <span style="color:#666">=</span> PLOT2;	<span style="color:#666">!</span>输出各参数的后验分布直方图等
</span></span></code></pre></div><pre tabindex="0"><code>MODEL RESULTS
                                Posterior  One-Tailed         95% C.I.
                    Estimate       S.D.      P-Value   Lower 2.5%  Upper 2.5%  Significance

Within Level

 Variances
    MORALE            33.312       0.413      0.000      32.511      34.124      *

Between Level

 Means
    MORALE            26.429       0.194      0.000      26.046      26.813      *

 Variances
    MORALE             5.506       0.684      0.000       4.361       7.041      *
</code></pre><h2 id="单变量模型在rjags中的实现">单变量模型在rjags中的实现</h2>
<h3 id="导入数据--设定模型">导入数据 &amp; 设定模型</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>varnames <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;deptid&#34;</span>, <span style="color:#4070a0">&#34;morale&#34;</span>, <span style="color:#4070a0">&#34;satpay&#34;</span>, <span style="color:#4070a0">&#34;female&#34;</span>, <span style="color:#4070a0">&#34;white&#34;</span>, <span style="color:#4070a0">&#34;pctbelow&#34;</span>, <span style="color:#4070a0">&#34;lev1wt&#34;</span>,<span style="color:#4070a0">&#34;lev2wt&#34;</span>)
</span></span><span style="display:flex;"><span>data <span style="color:#666">&lt;-</span> <span style="color:#06287e">read.table</span>(file<span style="color:#666">=</span><span style="color:#4070a0">&#34;ch3new.dat&#34;</span>)
</span></span><span style="display:flex;"><span>data[,<span style="color:#40a070">3</span><span style="color:#666">:</span><span style="color:#40a070">6</span>] <span style="color:#666">&lt;-</span> <span style="color:#06287e">scale</span>(data[,<span style="color:#40a070">3</span><span style="color:#666">:</span><span style="color:#40a070">6</span>])
</span></span><span style="display:flex;"><span><span style="color:#06287e">colnames</span>(data) <span style="color:#666">=</span> varnames
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">library</span>(rjags)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># 需要先下载JAGS软件 http://mcmc-jags.sourceforge.net/</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">library</span>(mcmcplots)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Define Model</span>
</span></span><span style="display:flex;"><span>modelstring <span style="color:#666">&lt;-</span> <span style="color:#06287e">as.character</span>(<span style="color:#4070a0">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">model{
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">for (g in 1:165){
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">for (i in 1:N[g]){
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  y[kk[g]+i] ~ dnorm(u[g], psi)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">}
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  u[g] ~ dnorm(umu, psiu)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">}
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0"># Prior for the mean of thetas
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	umu ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	##  !!JAGS为了便于程序运行采用精度代替方差，精度=1/方差，因此此处提供无信息先验精度需要设置得较小
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0"># Prior for the precision and variance 
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	psi ~ dgamma(1,1)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	psiu ~ dgamma(1,1)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	sigma.psi &lt;- 1/psi
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	sigma.psiu &lt;- 1/psiu
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">} # closes the model
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># data</span>
</span></span><span style="display:flex;"><span>temp <span style="color:#666">=</span> <span style="color:#06287e">read.table</span>(<span style="color:#4070a0">&#34;groupsize.txt&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># &#34;groupsize.txt&#34; 见https://zhanglj37.github.io/share/cos_multilevel/groupsize.txt</span>
</span></span><span style="display:flex;"><span>g <span style="color:#666">=</span> <span style="color:#40a070">165</span>
</span></span><span style="display:flex;"><span>n <span style="color:#666">=</span> <span style="color:#06287e">sum</span>(temp[,<span style="color:#40a070">1</span>])
</span></span><span style="display:flex;"><span>jags.data <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(y <span style="color:#666">=</span> data[,<span style="color:#40a070">2</span>], N <span style="color:#666">=</span> temp[,<span style="color:#40a070">1</span>], 
</span></span><span style="display:flex;"><span>				kk <span style="color:#666">=</span> temp[,<span style="color:#40a070">2</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>entities.to.monitor <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;umu&#34;</span>, <span style="color:#4070a0">&#34;sigma.psi&#34;</span>, <span style="color:#4070a0">&#34;sigma.psiu&#34;</span>)
</span></span></code></pre></div><h3 id="设定mcmc算法初始值及迭代次数等">设定MCMC算法初始值及迭代次数等</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## set initial value</span>
</span></span><span style="display:flex;"><span>u.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0</span>,g)
</span></span><span style="display:flex;"><span>umu.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>psi.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>psiu.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>u.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0.2</span>,g)
</span></span><span style="display:flex;"><span>umu.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>psi.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.5</span>
</span></span><span style="display:flex;"><span>psiu.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>u.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0.5</span>,g)
</span></span><span style="display:flex;"><span>umu.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>psi.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.8</span>
</span></span><span style="display:flex;"><span>psiu.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inits1 <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>	u <span style="color:#666">=</span> u.inits.1,
</span></span><span style="display:flex;"><span>	umu <span style="color:#666">=</span> umu.inits.1,
</span></span><span style="display:flex;"><span>	psi <span style="color:#666">=</span> psi.inits.1,
</span></span><span style="display:flex;"><span>	psiu <span style="color:#666">=</span> psiu.inits.1,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .RNG.name <span style="color:#666">=</span> <span style="color:#4070a0">&#34;base::Mersenne-Twister&#34;</span>, 
</span></span><span style="display:flex;"><span>    .RNG.seed <span style="color:#666">=</span> <span style="color:#40a070">10</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inits2 <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>	u <span style="color:#666">=</span> u.inits.2,
</span></span><span style="display:flex;"><span>	umu <span style="color:#666">=</span> umu.inits.2,
</span></span><span style="display:flex;"><span>	psi <span style="color:#666">=</span> psi.inits.2,
</span></span><span style="display:flex;"><span>	psiu <span style="color:#666">=</span> psiu.inits.2,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .RNG.name <span style="color:#666">=</span> <span style="color:#4070a0">&#34;base::Mersenne-Twister&#34;</span>, 
</span></span><span style="display:flex;"><span>    .RNG.seed <span style="color:#666">=</span> <span style="color:#40a070">20</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## inits</span>
</span></span><span style="display:flex;"><span>inits3 <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>	u <span style="color:#666">=</span> u.inits.3,
</span></span><span style="display:flex;"><span>	umu <span style="color:#666">=</span> umu.inits.3,
</span></span><span style="display:flex;"><span>	psi <span style="color:#666">=</span> psi.inits.3,
</span></span><span style="display:flex;"><span>	psiu <span style="color:#666">=</span> psiu.inits.3,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .RNG.name <span style="color:#666">=</span> <span style="color:#4070a0">&#34;base::Mersenne-Twister&#34;</span>, 
</span></span><span style="display:flex;"><span>    .RNG.seed <span style="color:#666">=</span> <span style="color:#40a070">30</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inits <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(inits1, inits2, inits3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Choose features of MCMC --------</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   the number of chains</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   the number of iterations to burn-in, </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#	  the number of iterations to thin by,</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#	  the total number of iterations </span>
</span></span><span style="display:flex;"><span>n.chains <span style="color:#666">=</span> <span style="color:#40a070">3</span>
</span></span><span style="display:flex;"><span>n.burnin <span style="color:#666">=</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>n.thin <span style="color:#666">=</span> <span style="color:#40a070">1</span>
</span></span><span style="display:flex;"><span>n.iters.total.per.chain <span style="color:#666">=</span>  <span style="color:#40a070">10000</span>
</span></span><span style="display:flex;"><span>n.burnin <span style="color:#666">=</span> <span style="color:#40a070">5000</span>
</span></span><span style="display:flex;"><span>n.iters.per.chain.after.burnin <span style="color:#666">=</span> n.iters.total.per.chain <span style="color:#666">-</span> n.burnin
</span></span></code></pre></div><h3 id="运行模型">运行模型</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Initialize the model</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Write out the model to a file</span>
</span></span><span style="display:flex;"><span>model.file.name <span style="color:#666">&lt;-</span> <span style="color:#4070a0">&#34;MLM2_model1.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">write</span>(x<span style="color:#666">=</span>modelstring, file<span style="color:#666">=</span><span style="color:#06287e">paste0</span>(model.file.name), append<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jags.model.initialized <span style="color:#666">&lt;-</span> <span style="color:#06287e">jags.model</span>(file<span style="color:#666">=</span>model.file.name,
</span></span><span style="display:flex;"><span>                                data<span style="color:#666">=</span>jags.data,
</span></span><span style="display:flex;"><span>                                n.chains<span style="color:#666">=</span>n.chains,
</span></span><span style="display:flex;"><span>                                inits<span style="color:#666">=</span>inits)
</span></span><span style="display:flex;"><span>								
</span></span><span style="display:flex;"><span>jags.model.fitted <span style="color:#666">&lt;-</span> <span style="color:#06287e">coda.samples</span>(
</span></span><span style="display:flex;"><span>  jags.model.initialized,
</span></span><span style="display:flex;"><span>  variable.names<span style="color:#666">=</span>entities.to.monitor,
</span></span><span style="display:flex;"><span>  n.iter<span style="color:#666">=</span>n.iters.total.per.chain,
</span></span><span style="display:flex;"><span>  progress.bar<span style="color:#666">=</span><span style="color:#4070a0">&#34;gui&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Define the draws from MCMC</span>
</span></span><span style="display:flex;"><span>draws.from.mcmc <span style="color:#666">&lt;-</span> jags.model.fitted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Define the names of parameters to use for convergence assessment</span>
</span></span><span style="display:flex;"><span>parameters.for.convergence <span style="color:#666">&lt;-</span> entities.to.monitor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Select the iterations to investigate</span>
</span></span><span style="display:flex;"><span>draws.to.analyze <span style="color:#666">&lt;-</span> <span style="color:#06287e">window</span>(draws.from.mcmc,
</span></span><span style="display:flex;"><span>                           start<span style="color:#666">=</span>n.burnin<span style="color:#40a070">+1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Combine chains </span>
</span></span><span style="display:flex;"><span>draws.to.analyze.as.one.list <span style="color:#666">&lt;-</span> <span style="color:#06287e">as.mcmc</span>(<span style="color:#06287e">do.call</span>(rbind,draws.to.analyze)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">coda.options</span>(combine.stats<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">TRUE</span>, combine.plots<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">TRUE</span>)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Extract the summary statistics</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   Usual</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   Percentiles</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   Later, HPD</span>
</span></span><span style="display:flex;"><span>summary.stats <span style="color:#666">&lt;-</span> <span style="color:#06287e">summary</span>(draws.to.analyze)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Numerically summarize the results</span>
</span></span><span style="display:flex;"><span>probability.for.HPD<span style="color:#666">=</span><span style="color:#40a070">.95</span>
</span></span><span style="display:flex;"><span>HPD.interval <span style="color:#666">&lt;-</span> <span style="color:#06287e">HPDinterval</span>(draws.to.analyze.as.one.list, prob<span style="color:#666">=</span>probability.for.HPD)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Organize and write out numerical summaries</span>
</span></span><span style="display:flex;"><span>summary.statistics <span style="color:#666">&lt;-</span> <span style="color:#06287e">cbind</span>(
</span></span><span style="display:flex;"><span>  summary.stats<span style="color:#666">$</span>statistics, 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">matrix</span>(HPD.interval, ncol<span style="color:#666">=</span><span style="color:#40a070">2</span>)
</span></span><span style="display:flex;"><span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">colnames</span>(summary.statistics) <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">colnames</span>(<span style="color:#06287e">summary</span>(jags.model.fitted)<span style="color:#666">$</span>statistics),
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;95% HPD lower&#34;</span>, <span style="color:#4070a0">&#34;95% HPD Upper&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">write.table</span>(summary.statistics,<span style="color:#4070a0">&#34;summary_model1.txt&#34;</span>)
</span></span></code></pre></div><h3 id="结果">结果</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>                Mean        SD    Naive SE Time<span style="color:#666">-</span>series SE <span style="color:#40a070">95</span><span style="color:#666">% HPD lower 95%</span> HPD Upper
</span></span><span style="display:flex;"><span>sigma.psi  <span style="color:#40a070">33.306586</span> <span style="color:#40a070">0.4110150</span> <span style="color:#40a070">0.003355923</span>    <span style="color:#40a070">0.003451017</span>     <span style="color:#40a070">32.535797</span>     <span style="color:#40a070">34.135397</span>
</span></span><span style="display:flex;"><span>sigma.psiu  <span style="color:#40a070">5.403783</span> <span style="color:#40a070">0.6696105</span> <span style="color:#40a070">0.005467347</span>    <span style="color:#40a070">0.006560731</span>      <span style="color:#40a070">4.177738</span>      <span style="color:#40a070">6.755166</span>
</span></span><span style="display:flex;"><span>umu        <span style="color:#40a070">26.428779</span> <span style="color:#40a070">0.1903632</span> <span style="color:#40a070">0.001554309</span>    <span style="color:#40a070">0.001702034</span>     <span style="color:#40a070">26.055863</span>     <span style="color:#40a070">26.806662</span>
</span></span></code></pre></div><h3 id="后验分布图及每条mcmc链的运行结果可以检验模型是否收敛">后验分布图，及每条MCMC链的运行结果，可以检验模型是否收敛</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#06287e">library</span>(mcmcplots)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Plot the results</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">mcmcplot</span>(
</span></span><span style="display:flex;"><span>  mcmcout <span style="color:#666">=</span> draws.to.analyze,
</span></span><span style="display:flex;"><span>  filename <span style="color:#666">=</span> <span style="color:#4070a0">&#34;MCMCoutput_model1&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p><a href="ex2/model1/MCMCoutput_model1.html">后验分布图</a></p>
<h2 id="假设模型在mplus中的实现">假设模型在Mplus中的实现</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>TITLE<span style="color:#666">:</span>	 Model <span style="color:#40a070">4</span><span style="color:#666">:</span> Explaining variation in the level<span style="color:#40a070">-2</span> intercept and slope;
</span></span><span style="display:flex;"><span>DATA<span style="color:#666">:</span>  FILE IS<span style="color:#666">:</span> C<span style="color:#666">:</span>\ Mplus1\ch3new.dat;
</span></span><span style="display:flex;"><span>	     Format is <span style="color:#40a070">5</span>f8.0, <span style="color:#40a070">3</span>f8.2;
</span></span><span style="display:flex;"><span>VARIABLE<span style="color:#666">:</span>	
</span></span><span style="display:flex;"><span>        Names are deptid morale satpay female white pctbelow lev1wt lev2wt;
</span></span><span style="display:flex;"><span>        Usevariables are deptid morale satpay female white pctbelow;
</span></span><span style="display:flex;"><span>        Cluster is deptid;  <span style="color:#666">!</span>分组变量为deptid
</span></span><span style="display:flex;"><span>        Between <span style="color:#666">=</span> pctbelow; <span style="color:#666">!</span>定义组间变量
</span></span><span style="display:flex;"><span>        Within <span style="color:#666">=</span> satpay female white; 
</span></span><span style="display:flex;"><span>Define<span style="color:#666">:</span>	Center satpay female white <span style="color:#06287e">pctbelow </span>(grandmean);  <span style="color:#666">!</span>中心化处理
</span></span><span style="display:flex;"><span>ANALYSIS<span style="color:#666">:</span>	
</span></span><span style="display:flex;"><span>        Type<span style="color:#666">=</span> Twolevel random;   <span style="color:#666">!</span>Twolevel定义两层模型，<span style="color:#06287e">random定义随机斜率</span>(β<span style="color:#40a070">1</span>)模型
</span></span><span style="display:flex;"><span>        Estimator <span style="color:#666">=</span> Bayes;  <span style="color:#666">!</span>定义估计方法
</span></span><span style="display:flex;"><span>        Biterations <span style="color:#666">=</span> (<span style="color:#40a070">20000</span>);  <span style="color:#666">!</span>定义模型最小迭代次数为<span style="color:#40a070">20000</span>次
</span></span><span style="display:flex;"><span>        Point <span style="color:#666">=</span> Median;  <span style="color:#666">!</span> 定义点估计报告后验分布的中位数结果
</span></span><span style="display:flex;"><span>Model<span style="color:#666">:</span>	<span style="color:#666">%Between%</span>
</span></span><span style="display:flex;"><span>    	morale S on pctbelow;  <span style="color:#666">!</span>用pctbelow预测morale和S
</span></span><span style="display:flex;"><span>    	S with morale;  <span style="color:#666">!</span>估计morale和S之间的相关
</span></span><span style="display:flex;"><span>    	<span style="color:#666">%Within%</span>
</span></span><span style="display:flex;"><span>    	morale on female white;  <span style="color:#666">!</span>用性别和人种预测morale 
</span></span><span style="display:flex;"><span>    	S <span style="color:#666">|</span> Morale on satpay;  <span style="color:#666">!</span>用satpay预测morale并用S表示satpay对morale的效应，即β<span style="color:#40a070">1</span>
</span></span><span style="display:flex;"><span>OUTPUT<span style="color:#666">:</span>	TECH1;
</span></span><span style="display:flex;"><span>PLOT<span style="color:#666">:</span> TYPE <span style="color:#666">=</span> PLOT2;	<span style="color:#666">!</span>输出各参数的后验分布直方图等
</span></span></code></pre></div><h2 id="假设模型在rjags中的实现">假设模型在rjags中的实现</h2>
<h3 id="代码">代码</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>varnames <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;deptid&#34;</span>, <span style="color:#4070a0">&#34;morale&#34;</span>, <span style="color:#4070a0">&#34;satpay&#34;</span>, <span style="color:#4070a0">&#34;female&#34;</span>, <span style="color:#4070a0">&#34;white&#34;</span>, <span style="color:#4070a0">&#34;pctbelow&#34;</span>, <span style="color:#4070a0">&#34;lev1wt&#34;</span>,<span style="color:#4070a0">&#34;lev2wt&#34;</span>)
</span></span><span style="display:flex;"><span>data <span style="color:#666">&lt;-</span> <span style="color:#06287e">read.table</span>(file<span style="color:#666">=</span><span style="color:#4070a0">&#34;ch3new.dat&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#data &lt;- scale(data)</span>
</span></span><span style="display:flex;"><span>data[,<span style="color:#40a070">3</span><span style="color:#666">:</span><span style="color:#40a070">6</span>] <span style="color:#666">&lt;-</span> <span style="color:#06287e">scale</span>(data[,<span style="color:#40a070">3</span><span style="color:#666">:</span><span style="color:#40a070">6</span>],center <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>,scale<span style="color:#666">=</span>F)
</span></span><span style="display:flex;"><span><span style="color:#06287e">colnames</span>(data) <span style="color:#666">=</span> varnames
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## 设定模型</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">library</span>(rjags)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># 需要先下载JAGS软件 http://mcmc-jags.sourceforge.net/</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">library</span>(mcmcplots)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Define Model</span>
</span></span><span style="display:flex;"><span>modelstring <span style="color:#666">&lt;-</span> <span style="color:#06287e">as.character</span>(<span style="color:#4070a0">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">model{
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">for (g in 1:165){
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">for (i in 1:N[g]){
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  y[kk[g]+i] ~ dnorm(u[kk[g]+i], psi)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  u[kk[g]+i] &lt;- beta0[g] + beta1[g]*satpay[kk[g]+i] + beta2*female[kk[g]+i] + beta3*white[kk[g]+i]
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">}
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  beta0[g] ~ dnorm(ubeta0[g], psibeta0)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  ubeta0[g] &lt;- gamma0*pctbelow[kk[g]+1] + mu0
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  beta1[g] ~ dnorm(ubeta1[g], psibeta1)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  ubeta1[g] &lt;- gamma1*pctbelow[kk[g]+1] + mu1
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">  
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">}
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0"># Prior for the mean of thetas
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	beta2 ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	beta3 ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	gamma0 ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	gamma1 ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	mu0 ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	mu1 ~ dnorm(0,0.00001)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0"># Prior for the precision and variance 
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	psi ~ dgamma(1,1)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	psibeta0 ~ dgamma(1,1)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	psibeta1 ~ dgamma(1,1)
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	sigma.psi &lt;- 1/psi
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	sigma.psibeta0 &lt;- 1/psibeta0
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">	sigma.psibeta1 &lt;- 1/psibeta1
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">} # closes the model
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0">&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># data</span>
</span></span><span style="display:flex;"><span>temp <span style="color:#666">=</span> <span style="color:#06287e">read.table</span>(<span style="color:#4070a0">&#34;groupsize.txt&#34;</span>)
</span></span><span style="display:flex;"><span>g <span style="color:#666">=</span> <span style="color:#40a070">165</span>
</span></span><span style="display:flex;"><span>n <span style="color:#666">=</span> <span style="color:#06287e">sum</span>(temp[,<span style="color:#40a070">1</span>])
</span></span><span style="display:flex;"><span>jags.data <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(y <span style="color:#666">=</span> data[,<span style="color:#40a070">2</span>], N <span style="color:#666">=</span> temp[,<span style="color:#40a070">1</span>], 
</span></span><span style="display:flex;"><span>				kk <span style="color:#666">=</span> temp[,<span style="color:#40a070">2</span>], 
</span></span><span style="display:flex;"><span>				satpay <span style="color:#666">=</span> data[,<span style="color:#40a070">3</span>], female <span style="color:#666">=</span> data[,<span style="color:#40a070">4</span>], white <span style="color:#666">=</span> data[,<span style="color:#40a070">5</span>], pctbelow <span style="color:#666">=</span> data[,<span style="color:#40a070">6</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>entities.to.monitor <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;beta2&#34;</span>, <span style="color:#4070a0">&#34;beta3&#34;</span>, <span style="color:#4070a0">&#34;gamma0&#34;</span>, <span style="color:#4070a0">&#34;gamma1&#34;</span>,  <span style="color:#4070a0">&#34;mu0&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#4070a0">&#34;mu1&#34;</span>,<span style="color:#4070a0">&#34;sigma.psi&#34;</span>, <span style="color:#4070a0">&#34;sigma.psibeta0&#34;</span>, <span style="color:#4070a0">&#34;sigma.psibeta1&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## 设定MCMC算法初始值及迭代次数等</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## set initial value</span>
</span></span><span style="display:flex;"><span>beta0.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0</span>,g)
</span></span><span style="display:flex;"><span>beta1.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0</span>,g)
</span></span><span style="display:flex;"><span>beta2.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>beta3.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>gamma0.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>gamma1.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>mu0.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>mu1.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>psi.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>psibeta0.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>psibeta1.inits.1 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>beta0.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0.2</span>,g)
</span></span><span style="display:flex;"><span>beta1.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0.2</span>,g)
</span></span><span style="display:flex;"><span>beta2.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.2</span>
</span></span><span style="display:flex;"><span>beta3.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.2</span>
</span></span><span style="display:flex;"><span>gamma0.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.2</span>
</span></span><span style="display:flex;"><span>gamma1.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.2</span>
</span></span><span style="display:flex;"><span>mu0.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.2</span>
</span></span><span style="display:flex;"><span>mu1.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.2</span>
</span></span><span style="display:flex;"><span>psi.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.5</span>
</span></span><span style="display:flex;"><span>psibeta0.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.5</span>
</span></span><span style="display:flex;"><span>psibeta1.inits.2 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>beta0.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0.3</span>,g)
</span></span><span style="display:flex;"><span>beta1.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#06287e">rep</span>(<span style="color:#40a070">0.3</span>,g)
</span></span><span style="display:flex;"><span>beta2.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>beta3.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>gamma0.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>gamma1.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>mu0.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>mu1.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.3</span>
</span></span><span style="display:flex;"><span>psi.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.8</span>
</span></span><span style="display:flex;"><span>psibeta0.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.8</span>
</span></span><span style="display:flex;"><span>psibeta1.inits.3 <span style="color:#666">&lt;-</span> <span style="color:#40a070">0.8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inits1 <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>	beta0 <span style="color:#666">=</span> beta0.inits.1,
</span></span><span style="display:flex;"><span>	beta1 <span style="color:#666">=</span> beta1.inits.1,
</span></span><span style="display:flex;"><span>	beta2 <span style="color:#666">=</span> beta2.inits.1,
</span></span><span style="display:flex;"><span>	beta3 <span style="color:#666">=</span> beta3.inits.1,
</span></span><span style="display:flex;"><span>	gamma0 <span style="color:#666">=</span> gamma0.inits.1,
</span></span><span style="display:flex;"><span>	gamma1 <span style="color:#666">=</span> gamma1.inits.1,
</span></span><span style="display:flex;"><span>	mu0 <span style="color:#666">=</span> mu0.inits.1,
</span></span><span style="display:flex;"><span>	mu1 <span style="color:#666">=</span> mu1.inits.1,
</span></span><span style="display:flex;"><span>	psi <span style="color:#666">=</span> psi.inits.1,
</span></span><span style="display:flex;"><span>	psibeta0 <span style="color:#666">=</span> psibeta0.inits.1,
</span></span><span style="display:flex;"><span>	psibeta1 <span style="color:#666">=</span> psibeta1.inits.1,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .RNG.name <span style="color:#666">=</span> <span style="color:#4070a0">&#34;base::Mersenne-Twister&#34;</span>, 
</span></span><span style="display:flex;"><span>    .RNG.seed <span style="color:#666">=</span> <span style="color:#40a070">10</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inits2 <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>	beta0 <span style="color:#666">=</span> beta0.inits.2,
</span></span><span style="display:flex;"><span>	beta1 <span style="color:#666">=</span> beta1.inits.2,
</span></span><span style="display:flex;"><span>	beta2 <span style="color:#666">=</span> beta2.inits.2,
</span></span><span style="display:flex;"><span>	beta3 <span style="color:#666">=</span> beta3.inits.2,
</span></span><span style="display:flex;"><span>	gamma0 <span style="color:#666">=</span> gamma0.inits.2,
</span></span><span style="display:flex;"><span>	gamma1 <span style="color:#666">=</span> gamma1.inits.2,
</span></span><span style="display:flex;"><span>	mu0 <span style="color:#666">=</span> mu0.inits.2,
</span></span><span style="display:flex;"><span>	mu1 <span style="color:#666">=</span> mu1.inits.2,
</span></span><span style="display:flex;"><span>	psi <span style="color:#666">=</span> psi.inits.2,
</span></span><span style="display:flex;"><span>	psibeta0 <span style="color:#666">=</span> psibeta0.inits.2,
</span></span><span style="display:flex;"><span>	psibeta1 <span style="color:#666">=</span> psibeta1.inits.2,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .RNG.name <span style="color:#666">=</span> <span style="color:#4070a0">&#34;base::Mersenne-Twister&#34;</span>, 
</span></span><span style="display:flex;"><span>    .RNG.seed <span style="color:#666">=</span> <span style="color:#40a070">20</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## inits</span>
</span></span><span style="display:flex;"><span>inits3 <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>	beta0 <span style="color:#666">=</span> beta0.inits.3,
</span></span><span style="display:flex;"><span>	beta1 <span style="color:#666">=</span> beta1.inits.3,
</span></span><span style="display:flex;"><span>	beta2 <span style="color:#666">=</span> beta2.inits.3,
</span></span><span style="display:flex;"><span>	beta3 <span style="color:#666">=</span> beta3.inits.3,
</span></span><span style="display:flex;"><span>	gamma0 <span style="color:#666">=</span> gamma0.inits.3,
</span></span><span style="display:flex;"><span>	gamma1 <span style="color:#666">=</span> gamma1.inits.3,
</span></span><span style="display:flex;"><span>	mu0 <span style="color:#666">=</span> mu0.inits.3,
</span></span><span style="display:flex;"><span>	mu1 <span style="color:#666">=</span> mu1.inits.3,
</span></span><span style="display:flex;"><span>	psi <span style="color:#666">=</span> psi.inits.3,
</span></span><span style="display:flex;"><span>	psibeta0 <span style="color:#666">=</span> psibeta0.inits.3,
</span></span><span style="display:flex;"><span>	psibeta1 <span style="color:#666">=</span> psibeta1.inits.3,
</span></span><span style="display:flex;"><span>    .RNG.name <span style="color:#666">=</span> <span style="color:#4070a0">&#34;base::Mersenne-Twister&#34;</span>, 
</span></span><span style="display:flex;"><span>    .RNG.seed <span style="color:#666">=</span> <span style="color:#40a070">30</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inits <span style="color:#666">&lt;-</span> <span style="color:#06287e">list</span>(inits1, inits2, inits3)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Choose features of MCMC --------</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   the number of chains</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   the number of iterations to burn-in, </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#	  the number of iterations to thin by,</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#	  the total number of iterations </span>
</span></span><span style="display:flex;"><span>n.chains <span style="color:#666">=</span> <span style="color:#40a070">3</span>
</span></span><span style="display:flex;"><span>n.burnin <span style="color:#666">=</span> <span style="color:#40a070">0</span>
</span></span><span style="display:flex;"><span>n.thin <span style="color:#666">=</span> <span style="color:#40a070">1</span>
</span></span><span style="display:flex;"><span>n.iters.total.per.chain <span style="color:#666">=</span>  <span style="color:#40a070">20000</span>
</span></span><span style="display:flex;"><span>n.burnin <span style="color:#666">=</span> <span style="color:#40a070">5000</span>
</span></span><span style="display:flex;"><span>n.iters.per.chain.after.burnin <span style="color:#666">=</span> n.iters.total.per.chain <span style="color:#666">-</span> n.burnin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">## 运行模型</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Initialize the model</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Write out the model to a file</span>
</span></span><span style="display:flex;"><span>model.file.name <span style="color:#666">&lt;-</span> <span style="color:#4070a0">&#34;MLM2.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">write</span>(x<span style="color:#666">=</span>modelstring, file<span style="color:#666">=</span><span style="color:#06287e">paste0</span>(model.file.name), append<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jags.model.initialized <span style="color:#666">&lt;-</span> <span style="color:#06287e">jags.model</span>(file<span style="color:#666">=</span>model.file.name,
</span></span><span style="display:flex;"><span>                                data<span style="color:#666">=</span>jags.data,
</span></span><span style="display:flex;"><span>                                n.chains<span style="color:#666">=</span>n.chains,
</span></span><span style="display:flex;"><span>                                inits<span style="color:#666">=</span>inits)
</span></span><span style="display:flex;"><span>								
</span></span><span style="display:flex;"><span>jags.model.fitted <span style="color:#666">&lt;-</span> <span style="color:#06287e">coda.samples</span>(
</span></span><span style="display:flex;"><span>  jags.model.initialized,
</span></span><span style="display:flex;"><span>  variable.names<span style="color:#666">=</span>entities.to.monitor,
</span></span><span style="display:flex;"><span>  n.iter<span style="color:#666">=</span>n.iters.total.per.chain,
</span></span><span style="display:flex;"><span>  progress.bar<span style="color:#666">=</span><span style="color:#4070a0">&#34;gui&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Define the draws from MCMC</span>
</span></span><span style="display:flex;"><span>draws.from.mcmc <span style="color:#666">&lt;-</span> jags.model.fitted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Define the names of parameters to use for convergence assessment</span>
</span></span><span style="display:flex;"><span>parameters.for.convergence <span style="color:#666">&lt;-</span> entities.to.monitor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Select the iterations to investigate</span>
</span></span><span style="display:flex;"><span>draws.to.analyze <span style="color:#666">&lt;-</span> <span style="color:#06287e">window</span>(draws.from.mcmc,
</span></span><span style="display:flex;"><span>                           start<span style="color:#666">=</span>n.burnin<span style="color:#40a070">+1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Combine chains </span>
</span></span><span style="display:flex;"><span>draws.to.analyze.as.one.list <span style="color:#666">&lt;-</span> <span style="color:#06287e">as.mcmc</span>(<span style="color:#06287e">do.call</span>(rbind,draws.to.analyze)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">coda.options</span>(combine.stats<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">TRUE</span>, combine.plots<span style="color:#666">=</span><span style="color:#007020;font-weight:bold">TRUE</span>)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Extract the summary statistics</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   Usual</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   Percentiles</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   Later, HPD</span>
</span></span><span style="display:flex;"><span>summary.stats <span style="color:#666">&lt;-</span> <span style="color:#06287e">summary</span>(draws.to.analyze)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Numerically summarize the results</span>
</span></span><span style="display:flex;"><span>probability.for.HPD<span style="color:#666">=</span><span style="color:#40a070">.95</span>
</span></span><span style="display:flex;"><span>HPD.interval <span style="color:#666">&lt;-</span> <span style="color:#06287e">HPDinterval</span>(draws.to.analyze.as.one.list, prob<span style="color:#666">=</span>probability.for.HPD)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Organize and write out numerical summaries</span>
</span></span><span style="display:flex;"><span>summary.statistics <span style="color:#666">&lt;-</span> <span style="color:#06287e">cbind</span>(
</span></span><span style="display:flex;"><span>  summary.stats<span style="color:#666">$</span>statistics, 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">matrix</span>(HPD.interval, ncol<span style="color:#666">=</span><span style="color:#40a070">2</span>)
</span></span><span style="display:flex;"><span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">colnames</span>(summary.statistics) <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">colnames</span>(<span style="color:#06287e">summary</span>(jags.model.fitted)<span style="color:#666">$</span>statistics),
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;95% HPD lower&#34;</span>, <span style="color:#4070a0">&#34;95% HPD Upper&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">write.table</span>(summary.statistics,<span style="color:#4070a0">&#34;summary.txt&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">library</span>(mcmcplots)
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Plot the results</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">mcmcplot</span>(
</span></span><span style="display:flex;"><span>  mcmcout <span style="color:#666">=</span> draws.to.analyze,
</span></span><span style="display:flex;"><span>  filename <span style="color:#666">=</span> <span style="color:#4070a0">&#34;MCMCoutput&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="结果-1">结果</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>                       Mean          SD     Naive SE Time<span style="color:#666">-</span>series SE <span style="color:#40a070">95</span><span style="color:#666">% HPD lower 95%</span> HPD Upper
</span></span><span style="display:flex;"><span>beta2           <span style="color:#40a070">0.009085682</span> <span style="color:#40a070">0.074093966</span> <span style="color:#40a070">3.492823e-04</span>   <span style="color:#40a070">3.611701e-04</span>  <span style="color:#40a070">-0.136651645</span>   <span style="color:#40a070">0.153880271</span>
</span></span><span style="display:flex;"><span>beta3           <span style="color:#40a070">0.905934469</span> <span style="color:#40a070">0.078113294</span> <span style="color:#40a070">3.682296e-04</span>   <span style="color:#40a070">4.163965e-04</span>   <span style="color:#40a070">0.753560122</span>   <span style="color:#40a070">1.059000079</span>
</span></span><span style="display:flex;"><span>gamma0         <span style="color:#40a070">-0.026639403</span> <span style="color:#40a070">0.007078300</span> <span style="color:#40a070">3.336742e-05</span>   <span style="color:#40a070">3.954912e-05</span>  <span style="color:#40a070">-0.040663578</span>  <span style="color:#40a070">-0.012720804</span>
</span></span><span style="display:flex;"><span>gamma1          <span style="color:#40a070">0.001172734</span> <span style="color:#40a070">0.001208740</span> <span style="color:#40a070">5.698054e-06</span>   <span style="color:#40a070">8.662830e-06</span>  <span style="color:#40a070">-0.001190107</span>   <span style="color:#40a070">0.003548654</span>
</span></span><span style="display:flex;"><span>mu0            <span style="color:#40a070">26.368838822</span> <span style="color:#40a070">0.112729075</span> <span style="color:#40a070">5.314100e-04</span>   <span style="color:#40a070">6.316542e-04</span>  <span style="color:#40a070">26.151635336</span>  <span style="color:#40a070">26.595102817</span>
</span></span><span style="display:flex;"><span>mu1             <span style="color:#40a070">1.193413952</span> <span style="color:#40a070">0.019639551</span> <span style="color:#40a070">9.258173e-05</span>   <span style="color:#40a070">1.428183e-04</span>   <span style="color:#40a070">1.154657311</span>   <span style="color:#40a070">1.231756464</span>
</span></span><span style="display:flex;"><span>sigma.psi      <span style="color:#40a070">17.420318119</span> <span style="color:#40a070">0.217577381</span> <span style="color:#40a070">1.025670e-03</span>   <span style="color:#40a070">1.038069e-03</span>  <span style="color:#40a070">16.995462346</span>  <span style="color:#40a070">17.847033090</span>
</span></span><span style="display:flex;"><span>sigma.psibeta0  <span style="color:#40a070">1.744403230</span> <span style="color:#40a070">0.231330078</span> <span style="color:#40a070">1.090500e-03</span>   <span style="color:#40a070">1.482352e-03</span>   <span style="color:#40a070">1.307833922</span>   <span style="color:#40a070">2.199548489</span>
</span></span><span style="display:flex;"><span>sigma.psibeta1  <span style="color:#40a070">0.038485610</span> <span style="color:#40a070">0.005508411</span> <span style="color:#40a070">2.596690e-05</span>   <span style="color:#40a070">3.976334e-05</span>   <span style="color:#40a070">0.028012146</span>   <span style="color:#40a070">0.049201418</span>
</span></span></code></pre></div><h3 id="后验分布图">后验分布图</h3>
<p><a href="ex2/model2/MCMCoutput.html">后验分布图</a></p>

    </div>
  </article>

  <br>
  <nav class="post-nav">
    <span class="nav-prev"></span>
    <span class="nav-next"><a href="/share/cos_multilevel/ex1/"></a> &rarr;</span>
  </nav>


   <br>
  
<section id="comments">
<div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://lijinzhang.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script src="https://utteranc.es/client.js"
    repo="zhanglj37/zhanglj37.github.io"
    issue-term="pathname"
    label="comments"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>


  <hr>
  <center>
    &copy; Lijin Zhang 2019 - 2022 | Powered by <a href="https://bookdown.org/yihui/blogdown/">Blogdown</a>
  </center>


</main>

<footer>
  
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
  } else if (e.which == 39) {  
    
    url = '\/share\/cos_multilevel\/ex1\/';
    
  }
  if (url) window.location = url;
});
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"></script>
<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
        ],
        ignoredTags: ["script", "noscript", "style", "textarea", "option", "pre"],
        throwOnError: false
      });
  });
</script>


<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



  



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  </footer>
  </article>
  
  </body>
</html>
